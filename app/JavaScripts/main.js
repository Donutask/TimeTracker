"use strict";const titleDisplay=document.getElementById("title"),startUI=document.getElementById("start-ui"),startTime=document.getElementById("start-time"),startButton=document.getElementById("start-button"),stopUI=document.getElementById("stop-ui"),elapsedTime=document.getElementById("elapsed-time"),startedTime=document.getElementById("started-time"),dataErrorUI=document.getElementById("null-data-ui"),startedTimeContainer=document.getElementById("started-time-container"),changeStartedTimeContainer=document.getElementById("change-start-time-container"),changeStartedTimeInput=document.getElementById("change-start-time"),setStopTimeButton=document.getElementById("stop-at"),setStopTimeContainer=document.getElementById("change-stop-time-container"),setStopTimeInput=document.getElementById("change-stop-time"),noteInput=document.getElementById("notes-input"),goalContainer=document.getElementById("goal-display"),noGoalContainer=document.getElementById("no-goal-display"),goalButton=document.getElementById("change-goal-button"),goalPercentageDisplay=document.getElementById("percentage-to-goal");let currentInterval,startDate,stopTime=null;function UpdateStartUI(){clearInterval(currentInterval),UpdateCurrentTimeDisplay(),currentInterval=setInterval(UpdateCurrentTimeDisplay,1e3)}function UpdateCurrentTimeDisplay(){startTime.textContent=DateTime.formatAMPM(DateTime.Now())}function UpdateStopUI(){const t=DateTime.Now();null!=startDate&&(DateTime.IsSameDate(startDate,t)?startedTime.textContent="Started at "+DateTime.formatAMPM(startDate):startedTime.textContent="Started at "+DateTime.formatAMPM(startDate)+" on "+startDate.ToDateString(),clearInterval(currentInterval),ElapsedTimeDisplay(),currentInterval=setInterval(ElapsedTimeDisplay,1e3))}function ElapsedTimeDisplay(){let t;if(t=null==stopTime?DateTime.Now():stopTime,!DateTime.IsNull(startDate)){const e=DateTime.DifferenceInMinutes(startDate,t);elapsedTime.textContent=DateTime.formatHoursMinutes(e),e<0?elapsedTime.classList.add("invalid-time"):elapsedTime.classList.remove("invalid-time")}}function ShowCorrectUI(){ShowTitle(),dataErrorUI.style.display="none",mainColumn.style.display="flex",DateTime.IsNull(startDate)?(startUI.style.display="flex",stopUI.style.display="none",UpdateStartUI()):(startUI.style.display="none",stopUI.style.display="flex",UpdateStopUI())}function ShowNullDataUI(){mainColumn.style.display="none",dataErrorUI.style.display="block"}function ShowTitle(){null!=mainData&&null!=mainData.title&&mainData.title.length>0?titleDisplay.textContent=mainData.title:titleDisplay.textContent="Time Tracker"}function StartTimer(){let t=DateTime.Now();startDate=t,localStorage.setItem("startDate",t.ToString()),ShowCorrectUI()}function StopTimer(){let t=DateTime.Now();if(DateTime.IsNull(startDate))console.error("Start date is null");else{let e;e=null==stopTime?t:stopTime;let a=DateTime.DifferenceInMinutes(startDate,e);if(a<0)return void alert("Error: End time is before start time.");if(a>=1440&&!confirm("Elapsed time is greater than 24 hours, continue?"))return;Math.round(a)>=1&&(null==mainData&&(mainData=new TimeTrackerData),mainData.Add(new Timespan(startDate,e)),SaveData(),UpdateCalendarAndDetails()),startDate=DateTime.NullDate(),localStorage.setItem("startDate","")}ShowCorrectUI()}function LoadStartDate(){let t=localStorage.getItem(startDateStorageKey);null!=t?startDate=DateTime.FromString(t):DateTime.NullDate()}function BeginChangeStartedTime(){BeginTimeChanger(startedTimeContainer,changeStartedTimeContainer,changeStartedTimeInput,startDate)}function SubmitStartTimeChange(t){t.preventDefault(),startDate.ChangeHoursMinutesFromTimeInputString(changeStartedTimeInput.value),localStorage.setItem("startDate",startDate.ToString()),ShowCorrectUI(),CloseStartTimeChange()}function CloseStartTimeChange(){startedTimeContainer.style.display="block",changeStartedTimeContainer.style.display="none"}function BeginSetStopTime(){const t=DateTime.Now();BeginTimeChanger(setStopTimeButton,setStopTimeContainer,setStopTimeInput,t),stopTime=t}function CancelSetStopTime(){setStopTimeButton.style.display="block",setStopTimeContainer.style.display="none",stopTime=null,ElapsedTimeDisplay()}function StopTimeChanged(){DateTime.IsNull(stopTime)?(stopTime=DateTime.Now(),stopTime.ChangeHoursMinutesFromTimeInputString(setStopTimeInput.value)):stopTime.ChangeHoursMinutesFromTimeInputString(setStopTimeInput.value),ElapsedTimeDisplay()}function BeginTimeChanger(t,e,a,n){t.style.display="none",e.style.display="block",null==n||DateTime.IsNull(n)||(a.value=n.FormatForTimeInput())}function RenameTracker(){null==mainData&&(mainData=new TimeTrackerData);let t=prompt("Rename",mainData.title);if(null!=t&&t.length>0){if(t.length>=1024)return void alert("Please choose a shorter title.");mainData.title=t,SaveData();saveSlots[currentSlot].Rename(t),ShowTitle(),GenerateSidebarList()}}function NoteInputChanged(){mainData.notes=noteInput.value,SaveData()}function UpdateNotesField(){null!=mainData&&(noteInput.value=mainData.notes)}function ChangeGoal(){const t=prompt("Set new monthly hour goal");if(null==t)return;const e=Number.parseFloat(t);isNaN(e)||(e<0?alert("Must be postive number"):(mainData.hourGoal=e,SaveData(),UpdateGoalButtonAndPercentage()))}function UpdateGoalButtonAndPercentage(){if(UpdateGoalContainerVisibility()){UpdateGoalButton();UpdateGoalPercentage(new Date(currentYear,currentMonth+1,0).getDate(),mainData.GetTotalMinutesForMonth(currentMonth,currentYear))}}function UpdateGoalButton(){const t=mainData.hourGoal;Number.isInteger(t)?goalButton.textContent=t+" hours":goalButton.textContent=DateTime.formatHoursMinutes(60*t).toString()}function UpdateGoalContainerVisibility(){return Number.isNaN(mainData.hourGoal)||mainData.hourGoal<=0?(goalContainer.hidden=!0,noGoalContainer.hidden=!1,!1):(goalContainer.hidden=!1,noGoalContainer.hidden=!0,!0)}function UpdateGoalPercentage(t,e){const a=Math.round(e/60/mainData.hourGoal*100);goalPercentageDisplay.textContent=a+"%";const n=Math.round(currentDate.getDate()/t*100);goalPercentageDisplay.className=a>=n?"goal-on-target":"goal-not-on-target"}changeStartedTimeContainer.addEventListener("submit",SubmitStartTimeChange),LoadStartDate(),InitialLoad();